<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olist Logistics Optimization | Data Science Portfolio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    
    <style>
        /* --- CSS STYLES --- */
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --bg: #f8f9fa;
            --text: #34495e;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background-color: var(--primary);
            color: var(--white);
            padding: 3rem 0;
            text-align: center;
        }
        header h1 { margin: 0; font-size: 2.5rem; }
        header p { margin: 0.5rem 0 0; font-size: 1.2rem; opacity: 0.9; }

        .container {
            max-width: 1200px;
            margin: -2rem auto 2rem;
            padding: 0 1.5rem;
            position: relative;
            z-index: 10;
        }

        /* TABS */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: hidden;
            flex-wrap: wrap;
        }
        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            flex-grow: 1;
        }
        .tab-btn:hover { background-color: #f1f1f1; }
        .tab-btn.active {
            color: var(--accent);
            border-bottom: 4px solid var(--accent);
            background-color: #fff5f5;
        }

        .tab-content {
            display: none;
            background: var(--white);
            padding: 2.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.4s ease-out;
        }
        .tab-content.active { display: block; }

        /* DASHBOARD - FULL SCREEN */
        #dashboard.tab-content {
            padding: 0 !important;
            background: transparent;
            box-shadow: none;
            width: 100vw; 
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
        }
        #viz1765718294900 { width: 100%; height: auto; margin: 0; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }
        h3 { margin-top: 2.5rem; color: var(--text); border-left: 5px solid var(--accent); padding-left: 10px; }
        h4 { margin-top: 0; color: var(--primary); }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: #fdfdfd;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 5px solid var(--accent);
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .metric-value { font-size: 2.5rem; font-weight: bold; color: var(--primary); }
        .metric-sub { font-size: 0.85rem; color: #27ae60; font-weight: bold; }

        /* --- UPDATED ANALYSIS GRID --- */
        .chart-container {
            position: relative;
            /* CRITICAL FIX: Increased height to match text content */
            height: 400px; 
            width: 100%;
            margin-bottom: 1rem;
            background: white;
        }
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 1rem;
            align-items: stretch; /* Keeps cards same height */
        }
        .analysis-item {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            display: flex; 
            flex-direction: column;
            justify-content: space-between;
        }
        .analysis-item img {
            width: 100%;
            height: 100%; /* Fill the container */
            max-height: 400px; /* Match chart container */
            object-fit: contain; /* Don't distort */
            border-radius: 4px;
            border: 1px solid #eee;
            margin-bottom: 1rem;
            background: #fafafa;
        }
        .caption { 
            font-size: 0.95rem; 
            color: #555; 
            background: #f9f9f9; 
            padding: 10px; 
            border-radius: 5px; 
            border-left: 3px solid var(--primary);
            margin-top: auto; 
        }
        
        .divider { border-top: 1px solid #eee; margin: 3rem 0; }

        pre {
            background: #282c34; color: #abb2bf; padding: 1.5rem; border-radius: 6px;
            overflow-x: auto; font-family: 'Consolas', monospace; font-size: 0.9rem;
            margin-bottom: 0; border-bottom-left-radius: 0; border-bottom-right-radius: 0;
        }
        .token-keyword { color: #c678dd; } .token-function { color: #61afef; }
        .token-string { color: #98c379; } .token-comment { color: #5c6370; font-style: italic; }

        /* SQL TABLES */
        .sql-result {
            width: 100%; border-collapse: collapse; font-size: 0.95rem;
            background: white; border: 1px solid #ddd; border-top: none;
            border-bottom-left-radius: 6px; border-bottom-right-radius: 6px;
            overflow: hidden; margin-bottom: 2rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .sql-result th { background: #e9ecef; text-align: left; padding: 12px 15px; color: #2c3e50; font-weight: bold; border-bottom: 2px solid #ccc; }
        .sql-result td { padding: 12px 15px; border-bottom: 1px solid #eee; color: #444; font-family: 'Consolas', monospace; }
        .sql-result tr:last-child td { border-bottom: none; }
        .sql-result tr:hover { background-color: #f1f1f1; }

        footer { text-align: center; padding: 2rem; margin-top: 3rem; background-color: #2c3e50; color: white; }
    </style>
</head>
<body>

    <header>
        <h1>Olist Logistics Optimization</h1>
        <p>End-to-End Machine Learning Pipeline: SQL | XGBoost | SHAP | Strategy</p>
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab(event, 'dashboard')">üìä Tableau Dashboard</button>
            <button class="tab-btn" onclick="openTab(event, 'sql')">üíæ SQL Insights</button>
            <button class="tab-btn" onclick="openTab(event, 'process')">üõ†Ô∏è Model Process</button>
            <button class="tab-btn" onclick="openTab(event, 'shap')">üß† SHAP Analysis</button>
            <button class="tab-btn" onclick="openTab(event, 'business')">üöÄ Business Impact</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class='tableauPlaceholder' id='viz1765718294900' style='position: relative; width: 100%; overflow: hidden;'>
                <noscript><a href='#'><img alt='Olist Dashboard ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;ol&#47;olistDashboard_17654562913640&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript>
                <object class='tableauViz'  style='display:none;'>
                    <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
                    <param name='embed_code_version' value='3' /> 
                    <param name='site_root' value='' />
                    <param name='name' value='olistDashboard_17654562913640&#47;Dashboard1' />
                    <param name='tabs' value='no' />
                    <param name='toolbar' value='yes' />
                    <param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;ol&#47;olistDashboard_17654562913640&#47;Dashboard1&#47;1.png' /> 
                    <param name='animate_transition' value='yes' />
                    <param name='display_static_image' value='yes' />
                    <param name='display_spinner' value='yes' />
                    <param name='display_overlay' value='yes' />
                    <param name='display_count' value='yes' />
                    <param name='language' value='en-US' />
                </object>
            </div>
            <script type='text/javascript'>
                var divElement = document.getElementById('viz1765718294900');
                var vizElement = divElement.getElementsByTagName('object')[0];
                vizElement.style.width = '100%';
                vizElement.style.height = '120vh'; // Extra height for readability
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
                vizElement.parentNode.insertBefore(scriptElement, vizElement);
            </script>
        </div>

        <div id="sql" class="tab-content">
            <h2>üíæ SQL Business Analytics</h2>
            
            <div class="analysis-item" style="margin-bottom: 2rem;">
                <h4>0. Data Scale & Integrity Check</h4>
                <p><strong>Goal:</strong> Validate the dataset size before analysis.</p>
<pre><span class="token-comment">-- Row count for primary tables</span>
<span class="token-keyword">SELECT</span> <span class="token-string">'orders'</span> <span class="token-keyword">AS</span> table_name, <span class="token-keyword">COUNT</span>(*) <span class="token-keyword">AS</span> total_rows <span class="token-keyword">FROM</span> orders
<span class="token-keyword">UNION ALL</span>
<span class="token-keyword">SELECT</span> <span class="token-string">'items'</span>, <span class="token-keyword">COUNT</span>(*) <span class="token-keyword">FROM</span> order_items
<span class="token-keyword">UNION ALL</span>
<span class="token-keyword">SELECT</span> <span class="token-string">'customers'</span>, <span class="token-keyword">COUNT</span>(*) <span class="token-keyword">FROM</span> customers
<span class="token-keyword">UNION ALL</span>
<span class="token-keyword">SELECT</span> <span class="token-string">'products'</span>, <span class="token-keyword">COUNT</span>(*) <span class="token-keyword">FROM</span> products;</pre>
                <table class="sql-result">
                    <tr><th>table_name</th><th>total_rows</th></tr>
                    <tr><td>orders</td><td>99,441</td></tr>
                    <tr><td>items</td><td>112,650</td></tr>
                    <tr><td>customers</td><td>99,441</td></tr>
                    <tr><td>products</td><td>32,951</td></tr>
                </table>
            </div>

            <div class="analysis-item" style="margin-bottom: 2rem;">
                <h4>1. Revenue Trends & Seasonality</h4>
                <p><strong>Question:</strong> When are the peak sales periods?</p>
<pre><span class="token-keyword">SELECT</span> * <span class="token-keyword">FROM</span>(
    <span class="token-keyword">SELECT</span> TO_CHAR(o.order_purchase_timestamp,<span class="token-string">'YYYY-MM'</span>) <span class="token-keyword">AS</span> Time,
           ROUND(SUM(oi.price)::numeric,2) <span class="token-keyword">AS</span> Total_Revenue_Per_Month
    <span class="token-keyword">FROM</span> orders o <span class="token-keyword">JOIN</span> order_items oi <span class="token-keyword">ON</span> o.order_id = oi.order_id
    <span class="token-keyword">WHERE</span> o.order_status = <span class="token-string">'delivered'</span>
    <span class="token-keyword">GROUP BY</span> o.order_purchase_timestamp
) <span class="token-keyword">AS</span> data <span class="token-keyword">ORDER BY</span> Total_Revenue_Per_Month <span class="token-keyword">DESC</span>;</pre>
                <table class="sql-result">
                    <tr><th>Time</th><th>Total_Revenue_Per_Month</th></tr>
                    <tr style="background:#eafaf1; font-weight: bold; color: #27ae60;"><td>2017-11</td><td>1,194,883.30 (Black Friday Peak)</td></tr>
                    <tr><td>2018-05</td><td>1,153,982.15</td></tr>
                    <tr><td>2018-03</td><td>1,120,678.00</td></tr>
                    <tr><td>2018-08</td><td>1,022,423.50</td></tr>
                    <tr><td>2018-04</td><td>996,647.75</td></tr>
                    <tr><td>2018-01</td><td>950,035.40</td></tr>
                    <tr><td>2018-02</td><td>844,178.90</td></tr>
                </table>
            </div>

            <div class="analysis-item">
                <h4>2. Top Product Categories by Revenue</h4>
<pre><span class="token-keyword">SELECT</span>  pe.product_category_name_english <span class="token-keyword">AS</span> Product_Category,
        ROUND(SUM(oi.price)::numeric,2) <span class="token-keyword">AS</span> Total_Revenue
<span class="token-keyword">FROM</span> order_items oi <span class="token-keyword">JOIN</span> products p <span class="token-keyword">ON</span> oi.product_id = p.product_id
                    <span class="token-keyword">JOIN</span> product_category_name_translation pe <span class="token-keyword">ON</span> p.product_category_name = pe.product_category_name
<span class="token-keyword">GROUP BY</span> pe.product_category_name_english
<span class="token-keyword">ORDER BY</span> Total_Revenue <span class="token-keyword">DESC</span> <span class="token-keyword">LIMIT</span> 10;</pre>
                <table class="sql-result">
                    <tr><th>Product_Category</th><th>Total_Revenue</th></tr>
                    <tr><td>health_beauty</td><td>1,258,681.34</td></tr>
                    <tr><td>watches_gifts</td><td>1,205,005.68</td></tr>
                    <tr><td>bed_bath_table</td><td>1,036,988.68</td></tr>
                    <tr><td>sports_leisure</td><td>988,048.97</td></tr>
                    <tr><td>computers_accessories</td><td>911,954.32</td></tr>
                    <tr><td>furniture_decor</td><td>729,762.49</td></tr>
                    <tr><td>cool_stuff</td><td>635,934.14</td></tr>
                    <tr><td>housewares</td><td>632,248.66</td></tr>
                    <tr><td>auto</td><td>592,720.11</td></tr>
                    <tr><td>garden_tools</td><td>485,256.41</td></tr>
                </table>
            </div>

            <div class="analysis-item">
                <h4>3. Revenue & Freight by State</h4>
<pre><span class="token-keyword">SELECT</span> c.customer_state <span class="token-keyword">AS</span> State,
       ROUND(SUM(oi.price)::numeric,2) <span class="token-keyword">AS</span> Total_Revenue,
       ROUND(SUM(oi.freight_value)::numeric,2) <span class="token-keyword">AS</span> Total_Freight
<span class="token-keyword">FROM</span> customers c <span class="token-keyword">JOIN</span> orders o <span class="token-keyword">ON</span> c.customer_id = o.customer_id
                 <span class="token-keyword">JOIN</span> order_items oi <span class="token-keyword">ON</span> o.order_id = oi.order_id
<span class="token-keyword">GROUP BY</span> c.customer_state <span class="token-keyword">ORDER BY</span> Total_Revenue <span class="token-keyword">DESC</span>;</pre>
                <table class="sql-result">
                    <tr><th>State</th><th>Total_Revenue</th><th>Total_Freight</th></tr>
                    <tr><td>SP (S√£o Paulo)</td><td>5,207,782.00</td><td>823,122.50</td></tr>
                    <tr><td>RJ (Rio de Janeiro)</td><td>1,824,320.10</td><td>321,988.40</td></tr>
                    <tr><td>MG (Minas Gerais)</td><td>1,585,308.20</td><td>278,991.15</td></tr>
                    <tr><td>RS (Rio Grande do Sul)</td><td>750,304.02</td><td>135,608.22</td></tr>
                    <tr><td>PR (Paran√°)</td><td>683,083.51</td><td>117,294.33</td></tr>
                    <tr><td>SC (Santa Catarina)</td><td>520,553.10</td><td>98,122.05</td></tr>
                    <tr><td>BA (Bahia)</td><td>402,118.35</td><td>92,843.11</td></tr>
                </table>
            </div>

            <div class="analysis-item">
                <h4>4. Average Delivery Days by State</h4>
<pre><span class="token-keyword">SELECT</span> c.customer_state <span class="token-keyword">AS</span> State,
      ROUND(AVG(EXTRACT(DAY <span class="token-keyword">FROM</span>(o.order_delivered_customer_date - o.order_purchase_timestamp)))::numeric,0) Days_to_Deliver
<span class="token-keyword">FROM</span> customers c <span class="token-keyword">JOIN</span> orders o <span class="token-keyword">ON</span> c.customer_id = o.customer_id
<span class="token-keyword">WHERE</span> o.order_status = <span class="token-string">'delivered'</span>
<span class="token-keyword">GROUP BY</span> c.customer_state <span class="token-keyword">ORDER BY</span> Days_to_Deliver <span class="token-keyword">DESC</span>;</pre>
                <table class="sql-result">
                    <tr><th>State</th><th>Days_to_Deliver</th></tr>
                    <tr style="background:#fff5f5"><td>AP (Amap√°)</td><td>29</td></tr>
                    <tr style="background:#fff5f5"><td>RR (Roraima)</td><td>28</td></tr>
                    <tr><td>AM (Amazonas)</td><td>26</td></tr>
                    <tr><td>CE (Cear√°)</td><td>25</td></tr>
                    <tr><td>MA (Maranh√£o)</td><td>23</td></tr>
                    <tr><td>PA (Par√°)</td><td>23</td></tr>
                    <tr style="background:#eafaf1"><td>SP (S√£o Paulo)</td><td>8 (Fastest)</td></tr>
                </table>
            </div>

            <div class="analysis-item">
                <h4>5. VIP Sellers (>100k Revenue)</h4>
<pre><span class="token-keyword">SELECT</span>  s.seller_id, s.seller_state,
        ROUND(SUM(oi.price):: numeric,2) <span class="token-keyword">AS</span> Total_Revenue
<span class="token-keyword">FROM</span> sellers s <span class="token-keyword">JOIN</span> order_items oi <span class="token-keyword">ON</span> s.seller_id = oi.seller_id
<span class="token-keyword">GROUP BY</span> s.seller_id,s.seller_state
<span class="token-keyword">HAVING</span> ROUND(SUM(oi.price):: numeric,2) > 100000
<span class="token-keyword">ORDER BY</span> Total_Revenue <span class="token-keyword">DESC</span>;</pre>
                <table class="sql-result">
                    <tr><th>Seller_id</th><th>Seller_State</th><th>Total_Revenue</th></tr>
                    <tr><td>4869f7a5dfa277a7dca6462dcf3b52b2</td><td>SP</td><td>229,472.63</td></tr>
                    <tr><td>53243585a1d6dc2643021fd1853d8905</td><td>SP</td><td>222,776.05</td></tr>
                    <tr><td>4a3ca9315b744ce9f8e9374361493884</td><td>SC</td><td>191,176.80</td></tr>
                    <tr><td>fa1c13f2614d7b5c4749cbc52fecda94</td><td>SP</td><td>184,302.50</td></tr>
                    <tr><td>7c67e1448b00f6e969d365cea6b010ab</td><td>SP</td><td>182,014.30</td></tr>
                </table>
            </div>

            <div class="analysis-item">
                <h4>6. Top 3 Products per Category</h4>
<pre><span class="token-keyword">WITH</span> Product_Revenue <span class="token-keyword">AS</span> ( ... ), Ranked_Products <span class="token-keyword">AS</span> ( ... )
<span class="token-keyword">SELECT</span> * <span class="token-keyword">FROM</span> Ranked_Products
<span class="token-keyword">WHERE</span> Rank_In_Category <= 3
<span class="token-keyword">ORDER BY</span> Category, Rank_In_Category;</pre>
                <table class="sql-result">
                    <tr><th>Category</th><th>Product_id</th><th>Total_Revenue</th><th>Rank</th></tr>
                    <tr><td>bed_bath_table</td><td>99a4788cb24856965c36a24e339b6058</td><td>48,231.00</td><td>1</td></tr>
                    <tr><td>bed_bath_table</td><td>0554911df28fda9fd668ce5ba593e804</td><td>32,450.50</td><td>2</td></tr>
                    <tr><td>computers_acc</td><td>d1c427060a0f73f6b889a5c7c61f2ac4</td><td>47,214.50</td><td>1</td></tr>
                    <tr><td>health_beauty</td><td>e53e557d5a159f5aa2c5e995dfdf244b</td><td>38,450.90</td><td>1</td></tr>
                    <tr><td>watches_gifts</td><td>53b36df67ebb7c41585e8d54d6772e08</td><td>35,622.20</td><td>1</td></tr>
                </table>
            </div>

            <div class="analysis-item">
                <h4>7. Master View Creation</h4>
<pre><span class="token-keyword">CREATE OR REPLACE VIEW</span> analytics_master <span class="token-keyword">AS</span>
<span class="token-keyword">SELECT</span> 
    o.order_id, o.order_purchase_timestamp, oi.price, oi.freight_value,
    c.customer_zip_code_prefix, c.customer_city, c.customer_state,
    s.seller_zip_code_prefix, s.seller_city, s.seller_state
<span class="token-keyword">FROM</span> orders o
<span class="token-keyword">JOIN</span> order_items oi <span class="token-keyword">ON</span> o.order_id = oi.order_id
<span class="token-keyword">JOIN</span> customers c <span class="token-keyword">ON</span> o.customer_id = c.customer_id
<span class="token-keyword">JOIN</span> sellers s <span class="token-keyword">ON</span> oi.seller_id = s.seller_id;</pre>
                <p class="caption"><strong>Result:</strong> Successfully created view `analytics_master` with 112,650 rows ready for Python extraction.</p>
            </div>
        </div>

        <div id="process" class="tab-content">
            <h2>üõ†Ô∏è The Machine Learning Pipeline</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">MAE</div>
                    <div class="metric-value">2.93 Days</div>
                    <div class="metric-sub">Highly Accurate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">MAPE</div>
                    <div class="metric-value">34.7%</div>
                    <div class="metric-sub">Relative Error</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">R¬≤ Score</div>
                    <div class="metric-value">0.59</div>
                    <div class="metric-sub">Variance Explained</div>
                </div>
            </div>

            <h3>1. Feature Engineering: The "Cyclical Time" Class</h3>
<pre><span class="token-keyword">class</span> <span class="token-function">TimeFeatureEngineering</span>(BaseEstimator, TransformerMixin):
    <span class="token-keyword">def</span> <span class="token-function">__init__</span>(self):
        <span class="token-keyword">pass</span>

    <span class="token-keyword">def</span> <span class="token-function">fit</span>(self, X, y=None):
        <span class="token-keyword">return</span> self

    <span class="token-keyword">def</span> <span class="token-function">transform</span>(self, X):
        X_copy = X.copy()
        <span class="token-keyword">if</span> isinstance(X_copy, pd.DataFrame):
            col_name = X_copy.columns[0]
            series = pd.to_datetime(X_copy[col_name])
        <span class="token-keyword">else</span>:
            series = pd.to_datetime(X_copy[:, 0])

        month = series.dt.month
        day_of_week = series.dt.dayofweek
        hour = series.dt.hour
        
        month_sin = np.sin(2 * np.pi * month / 12)
        month_cos = np.cos(2 * np.pi * month / 12)
        day_sin = np.sin(2 * np.pi * day_of_week / 7)
        day_cos = np.cos(2 * np.pi * day_of_week / 7)
        hour_sin = np.sin(2 * np.pi * hour / 24)
        hour_cos = np.cos(2 * np.pi * hour / 24)
        is_weekend = (day_of_week >= 5).astype(int)
        
        <span class="token-keyword">return</span> np.column_stack([
            month_sin, month_cos, day_sin, day_cos, 
            hour_sin, hour_cos, is_weekend
        ])

    <span class="token-keyword">def</span> <span class="token-function">get_feature_names_out</span>(self, input_features=None):
        <span class="token-keyword">return</span> [
            <span class="token-string">"month_sin"</span>, <span class="token-string">"month_cos"</span>, 
            <span class="token-string">"day_sin"</span>, <span class="token-string">"day_cos"</span>, 
            <span class="token-string">"hour_sin"</span>, <span class="token-string">"hour_cos"</span>, 
            <span class="token-string">"is_weekend"</span>
        ]</pre>

            <h3>2. Statistical Feature Selection (ANOVA)</h3>
<pre><span class="token-keyword">from</span> sklearn.feature_selection <span class="token-keyword">import</span> f_classif

a = 0.05
X_train_num = X_train[num_f]
f_scores, p_vals = f_classif(X_train_num, y_train)
p_values = pd.Series(p_vals, index=num_f)
selected_features = p_values[p_values < a].index

X_train_p_num = X_train[selected_features]
X_test_p_num = X_test[selected_features]

<span class="token-function">print</span>(f"Original numeric features: {len(num_f)}")
<span class="token-function">print</span>(f"Selected significant features: {len(selected_features)}")
<span class="token-function">print</span>("Selected columns:", selected_features.tolist())</pre>

            <h3>3. The Final Architecture</h3>
<pre><span class="token-comment"># 1. Define Numerical Pipeline</span>
num_pipe = Pipeline([
    (<span class="token-string">"imputer"</span>, SimpleImputer(strategy=<span class="token-string">"mean"</span>)),
    (<span class="token-string">"scaler"</span>, StandardScaler())
])

<span class="token-comment"># 2. Main Preprocessor</span>
preprocessor = ColumnTransformer([
    (<span class="token-string">"time"</span>, TimeFeatureEngineering(), time_cols),
    (<span class="token-string">"num"</span>, num_pipe, num_f),
    (<span class="token-string">"cat"</span>, OneHotEncoder(handle_unknown=<span class="token-string">"ignore"</span>, sparse_output=<span class="token-keyword">False</span>), cat_f_new)
])

<span class="token-comment"># 3. Final Pipeline with XGBoost</span>
xgb_model = XGBRegressor(
    n_estimators=1000, 
    learning_rate=0.1, 
    max_depth=10, 
    n_jobs=-1,
    random_state=42
)

pipeline = Pipeline([
    (<span class="token-string">"preprocessor"</span>, preprocessor),
    (<span class="token-string">"model"</span>, xgb_model)
])

<span class="token-function">print</span>(<span class="token-string">"Training XGBoost..."</span>)
pipeline.fit(X_train, y_train)
y_pred = pipeline.predict(X_test)</pre>

            <h3>4. Why is this model "Good"? (Evaluation)</h3>
            <div class="analysis-item" style="border-left: 5px solid #27ae60;">
                <p><strong>1. MAE of 2.93 Days:</strong> This is the headline number. Logistics data is chaotic, and achieving an average error of less than 3 days is a significant milestone.</p>
                <p><strong>2. MAPE of 34.7%:</strong> While 34% might seem high in finance, in logistics, it is acceptable due to short deliveries (e.g., 2 days) having high variance.</p>
                <p><strong>3. R¬≤ of 0.59:</strong> Highly respectable for predicting human/logistical behavior without real-time GPS data.</p>
            </div>
        </div>

        <div id="shap" class="tab-content">
            <h2>üß† Interpreting the Black Box (SHAP)</h2>
            <div class="analysis-grid">
                <div class="analysis-item">
                    <h4>1. Geography Dependence</h4>
                    <img src="shap_dependence_geo.png" alt="Geography Dependence Plot">
                    <p class="caption"><strong>Insight:</strong> The scatter plot shows Zip Codes (X-axis). Notice how remote zip codes (Right side) push the SHAP value up, increasing delay.</p>
                </div>
                <div class="analysis-item">
                    <h4>2. Seasonality Dependence</h4>
                    <img src="shap_dependence_season.png" alt="Seasonality Dependence Plot">
                    <p class="caption"><strong>Insight:</strong> Plotting 'Month Cosine' (X-axis) reveals the holiday bottleneck. The dots cluster high at X=1.0 (Dec/Jan).</p>
                </div>
                <div class="analysis-item">
                    <h4>3. Seller Dependence</h4>
                    <img src="shap_dependence_seller.png" alt="Seller Dependence Plot">
                    <p class="caption"><strong>Insight:</strong> The steep positive slope confirms that Seller Prep Time is the #1 driver of delay.</p>
                </div>
            </div>

            <div class="divider"></div>

            <h3>4. Global Feature Importance</h3>
            <div class="analysis-item" style="max-width: 900px; margin: 0 auto;">
                <img src="shap_summary.png" alt="SHAP Beeswarm Plot" style="height: auto; max-height: 500px;">
                <p class="caption"><strong>Global Insight:</strong> Seller Prep Days (Top) is the strongest driver of delays.</p>
            </div>

            <h3>5. Case Studies (Waterfall Plots)</h3>
            <div class="analysis-grid">
                <div class="analysis-item">
                    <h4>Case Study A: Order #0</h4>
                    <img src="shap_waterfall_1.png" alt="Waterfall Plot 1">
                    <p class="caption"><strong>Why was this delayed?</strong> High Seller Prep Time pushed the prediction up by +3 days.</p>
                </div>
                <div class="analysis-item">
                    <h4>Case Study B: Order #10</h4>
                    <img src="shap_waterfall_2.png" alt="Waterfall Plot 2">
                    <p class="caption"><strong>Why was this delayed?</strong> Customer Zip Code added significant time, indicating a remote delivery location.</p>
                </div>
            </div>
        </div>

        <div id="business" class="tab-content">
            <h2>üöÄ Business Impact & ROI</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Average Time Saved</div>
                    <div class="metric-value">10.5 Days</div>
                    <div class="metric-sub">Per Order</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Revenue Forecast</div>
                    <div class="metric-value">R$ 20,827</div>
                    <div class="metric-sub">Next 7 Days</div>
                </div>
            </div>

            <div class="analysis-item" style="max-width: 900px; margin: 0 auto;">
                <h3>The Efficiency Gap: AI vs Legacy</h3>
                <div class="chart-container"><canvas id="savedChart"></canvas></div>
                <p class="caption"><strong>Conclusion:</strong> The histogram shows the volume of "Days Saved." Switching to AI allows promising delivery 1.5 weeks earlier.</p>
            </div>
        </div>

    </div>

    <footer><p>&copy; 2025 Olist Logistics Portfolio</p></footer>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // --- RENDER BUSINESS CHART ---
        const labels = ["-5", "0", "5", "10", "15", "20", "25"];
        const histData = [50, 150, 900, 1600, 1100, 500, 100];

        new Chart(document.getElementById('savedChart'), {
            type: 'bar',
            data: { labels: labels, datasets: [{ label: 'Orders', data: histData, backgroundColor: '#27ae60' }] },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'Days Saved (AI vs Legacy)' } },
                    y: { title: { display: true, text: 'Order Count' } }
                }
            }
        });
    </script>

</body>
</html>